<script setup lang="ts">
import { computed } from 'vue';
import LkIndexBar from '@/uni_modules/lucky-ui/components/lk-index-bar/lk-index-bar.vue';
import LkIndexAnchor from '@/uni_modules/lucky-ui/components/lk-index-bar/lk-index-anchor.vue';

interface Contact {
  id: string;
  name: string;
  phone: string;
  avatar: string;
  color: string;
  pinyin: string;
}

// ËÅîÁ≥ª‰∫∫Êï∞ÊçÆ
const contacts: Contact[] = [
  { id: '1', name: 'ËâæÁ±≥', phone: '138****1234', avatar: 'Ëâæ', color: '#FF6B6B', pinyin: 'A' },
  { id: '2', name: 'ÂÆâÁê™', phone: '139****5678', avatar: 'ÂÆâ', color: '#4ECDC4', pinyin: 'A' },
  { id: '3', name: 'ÁôΩÈú≤', phone: '137****9012', avatar: 'ÁôΩ', color: '#45B7D1', pinyin: 'B' },
  { id: '4', name: 'ÈôàÊÄù', phone: '136****3456', avatar: 'Èôà', color: '#96CEB4', pinyin: 'C' },
  { id: '5', name: 'Á®ãÊòé', phone: '135****7890', avatar: 'Á®ã', color: '#FFEAA7', pinyin: 'C' },
  { id: '6', name: 'Êà¥ÂÆâ', phone: '134****1234', avatar: 'Êà¥', color: '#DDA0DD', pinyin: 'D' },
  { id: '7', name: 'ÊùúÈπÉ', phone: '133****5678', avatar: 'Êùú', color: '#98D8C8', pinyin: 'D' },
  { id: '8', name: 'ËåÉÂÜ∞', phone: '132****9012', avatar: 'ËåÉ', color: '#F7DC6F', pinyin: 'F' },
  { id: '9', name: 'È´òËøú', phone: '131****3456', avatar: 'È´ò', color: '#BB8FCE', pinyin: 'G' },
  { id: '10', name: 'ÈÉ≠Èùñ', phone: '130****7890', avatar: 'ÈÉ≠', color: '#85C1E9', pinyin: 'G' },
  { id: '11', name: 'Èü©Èõ™', phone: '159****1234', avatar: 'Èü©', color: '#F1948A', pinyin: 'H' },
  { id: '12', name: 'ÈªÑËìâ', phone: '158****5678', avatar: 'ÈªÑ', color: '#82E0AA', pinyin: 'H' },
  { id: '13', name: 'Ë¥æÂÆù', phone: '157****9012', avatar: 'Ë¥æ', color: '#F8C471', pinyin: 'J' },
  { id: '14', name: 'ÈáëËé≤', phone: '156****3456', avatar: 'Èáë', color: '#AED6F1', pinyin: 'J' },
  { id: '15', name: 'Â≠îÊòé', phone: '155****7890', avatar: 'Â≠î', color: '#D7BDE2', pinyin: 'K' },
  { id: '16', name: 'ÊùéÁôΩ', phone: '188****1234', avatar: 'Êùé', color: '#A3E4D7', pinyin: 'L' },
  { id: '17', name: 'ÊûóÈªõ', phone: '187****5678', avatar: 'Êûó', color: '#FAD7A0', pinyin: 'L' },
  { id: '18', name: 'ÂàòÂ§á', phone: '186****9012', avatar: 'Âàò', color: '#F5B7B1', pinyin: 'L' },
  { id: '19', name: 'È©¨‰∫ë', phone: '185****3456', avatar: 'È©¨', color: '#ABEBC6', pinyin: 'M' },
  { id: '20', name: 'ÁâõÈ°ø', phone: '184****7890', avatar: 'Áâõ', color: '#D2B4DE', pinyin: 'N' },
  { id: '21', name: 'Ê¨ßÈò≥', phone: '183****1234', avatar: 'Ê¨ß', color: '#AED6F1', pinyin: 'O' },
  { id: '22', name: 'ÊΩòÈáë', phone: '182****5678', avatar: 'ÊΩò', color: '#F9E79F', pinyin: 'P' },
  { id: '23', name: 'Áß¶Âßã', phone: '181****9012', avatar: 'Áß¶', color: '#FADBD8', pinyin: 'Q' },
  { id: '24', name: '‰ªªÁõà', phone: '180****3456', avatar: '‰ªª', color: '#D5F5E3', pinyin: 'R' },
  { id: '25', name: 'Â≠ôÊÇü', phone: '199****7890', avatar: 'Â≠ô', color: '#FDEDEC', pinyin: 'S' },
  { id: '26', name: 'ÂîêÂÉß', phone: '198****1234', avatar: 'Âîê', color: '#EBF5FB', pinyin: 'T' },
  { id: '27', name: 'ÁéãÁÜô', phone: '197****5678', avatar: 'Áéã', color: '#F4ECF7', pinyin: 'W' },
  { id: '28', name: 'Âê¥Áî®', phone: '196****9012', avatar: 'Âê¥', color: '#E8F8F5', pinyin: 'W' },
  { id: '29', name: 'Â§èÈõ®', phone: '195****3456', avatar: 'Â§è', color: '#FEF9E7', pinyin: 'X' },
  { id: '30', name: 'Êù®Ëøá', phone: '194****7890', avatar: 'Êù®', color: '#FBEEE6', pinyin: 'Y' },
  { id: '31', name: 'Âº†È£û', phone: '193****1234', avatar: 'Âº†', color: '#F5EEF8', pinyin: 'Z' },
  { id: '32', name: 'Ëµµ‰∫ë', phone: '192****5678', avatar: 'Ëµµ', color: '#EAF2F8', pinyin: 'Z' },
  { id: '33', name: 'Âë®Áëú', phone: '191****9012', avatar: 'Âë®', color: '#E9F7EF', pinyin: 'Z' },
];

// ÂàÜÁªÑÂêéÁöÑËÅîÁ≥ª‰∫∫
const contactGroups = computed(() => {
  const groups: { letter: string; contacts: Contact[] }[] = [];
  const map = new Map<string, Contact[]>();

  contacts.forEach(contact => {
    const letter = contact.pinyin;
    if (!map.has(letter)) {
      map.set(letter, []);
    }
    map.get(letter)!.push(contact);
  });

  // ÊéíÂ∫è
  const sortedKeys = Array.from(map.keys()).sort();
  sortedKeys.forEach(letter => {
    groups.push({ letter, contacts: map.get(letter)! });
  });

  return groups;
});

// Á¥¢ÂºïÂàóË°®
const indexList = computed(() => contactGroups.value.map(g => g.letter));

function onSelect(letter: string) {
  console.log('ÈÄâÊã©Á¥¢Âºï:', letter);
}

function onContactClick(contact: Contact) {
  uni.showToast({
    title: `${contact.name} - ${contact.phone}`,
    icon: 'none',
  });
}
</script>

<template>
  <view class="contacts-page">
    <!-- ÊêúÁ¥¢Ê†è -->
    <view class="search-bar">
      <view class="search-input">
        <text class="search-icon">üîç</text>
        <text class="search-placeholder">ÊêúÁ¥¢ËÅîÁ≥ª‰∫∫</text>
      </view>
    </view>

    <!-- ËÅîÁ≥ª‰∫∫ÂàóË°® -->
    <lk-index-bar :index-list="indexList" @select="onSelect">
      <lk-index-anchor
        v-for="group in contactGroups"
        :key="group.letter"
        :index="group.letter"
        :title="group.letter"
      >
        <view
          v-for="contact in group.contacts"
          :key="contact.id"
          class="contact-item"
          @click="onContactClick(contact)"
        >
          <view class="contact-avatar" :style="{ background: contact.color }">
            {{ contact.avatar }}
          </view>
          <view class="contact-info">
            <view class="contact-name">{{ contact.name }}</view>
            <view class="contact-desc">{{ contact.phone }}</view>
          </view>
          <view class="contact-actions">
            <view class="action-btn action-btn--call">üìû</view>
            <view class="action-btn action-btn--msg">üí¨</view>
          </view>
        </view>
      </lk-index-anchor>
    </lk-index-bar>
  </view>
</template>
<style scoped lang="scss">
.contacts-page {
  min-height: 100vh;
  background: var(--lk-color-bg-page);
  padding-bottom: 100rpx;
}

.search-bar {
  position: sticky;
  top: 0;
  z-index: 50;
  padding: 24rpx 32rpx;
  background: var(--lk-color-bg-container);
  border-bottom: 2rpx solid var(--lk-color-border-light);
}

.search-input {
  display: flex;
  align-items: center;
  gap: 16rpx;
  padding: 20rpx 28rpx;
  background: var(--lk-color-fill-quaternary);
  border-radius: 48rpx;
}

.search-icon {
  font-size: 32rpx;
  opacity: 0.5;
}

.search-placeholder {
  font-size: 28rpx;
  color: var(--lk-color-text-tertiary);
}

.contact-item {
  display: flex;
  align-items: center;
  gap: 24rpx;
  padding: 24rpx 32rpx;
  background: var(--lk-color-bg-container);
  transition: background 0.2s ease;

  &:active {
    background: var(--lk-color-fill-quaternary);
  }
}

.contact-avatar {
  width: 96rpx;
  height: 96rpx;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 36rpx;
  font-weight: 600;
  color: #fff;
  flex-shrink: 0;
  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.1);
}

.contact-info {
  flex: 1;
  min-width: 0;
}

.contact-name {
  font-size: 32rpx;
  font-weight: 500;
  color: var(--lk-color-text);
  margin-bottom: 8rpx;
}

.contact-desc {
  font-size: 26rpx;
  color: var(--lk-color-text-tertiary);
}

.contact-actions {
  display: flex;
  gap: 24rpx;
}

.action-btn {
  width: 72rpx;
  height: 72rpx;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28rpx;
  transition: all 0.2s ease;

  &:active {
    transform: scale(0.9);
  }

  &--call {
    background: linear-gradient(135deg, #4ecdc4 0%, #44a3aa 100%);
  }

  &--msg {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }
}
</style>
