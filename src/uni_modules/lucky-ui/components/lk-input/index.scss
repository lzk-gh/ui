@use '../../theme/src/mixins/bem' as *;

@include b(input) {
  --_height: var(--lk-control-height-md);
  --_fs: var(--lk-control-font-size-md);
  --_px: var(--lk-control-padding-x-md);
  --_radius: var(--lk-radius-lg);
  --_border: var(--lk-color-border-light);
  --_border-hover: var(--lk-color-primary);
  --_border-active: var(--lk-color-primary);
  // 使用新的占位符颜色变量
  --_placeholder: var(--lk-text-placeholder);
  // 优化输入框背景色，使用更干净的填充色
  --_bg: var(--lk-bg-input);

  position: relative;
  display: inline-flex;
  align-items: center;
  width: 100%;
  background: var(--_bg);
  border: 2rpx solid var(--_border);
  border-radius: var(--_radius);
  padding: 0 var(--_px);
  transition:
    border-color var(--lk-transition-fast),
    box-shadow var(--lk-transition-fast),
    background-color var(--lk-transition-fast);

  @include m(sm) {
    --_height: var(--lk-control-height-sm);
    --_fs: var(--lk-control-font-size-sm);
    --_px: var(--lk-control-padding-x-sm);
    --_radius: var(--lk-radius-md);
  }

  @include m(lg) {
    --_height: var(--lk-control-height-lg);
    --_fs: var(--lk-control-font-size-lg);
    --_px: var(--lk-control-padding-x-lg);
    --_radius: var(--lk-radius-full);
  }

  @include e(inner) {
    flex: 1;
    height: var(--_height);
    font-size: var(--_fs);
    background: transparent;
    border: 0 !important;
    box-shadow: none !important;
    outline: none;
    padding: 0;
    // 使用新的中性文字颜色变量
    color: var(--lk-text-primary);
    line-height: calc(var(--_height) - 4rpx);

    &::placeholder {
      // 使用新的占位符颜色变量
      color: var(--lk-text-placeholder);
    }
  }

  @include e(prefix) {
    display: flex;
    align-items: center;
    // 使用新的中性文字颜色变量
    color: var(--lk-text-secondary);
    flex-shrink: 0;
    // 调整图标与输入内容的间距，使其看起来更均匀
    margin-right: var(--lk-spacing-sm);
  }

  @include e(suffix) {
    display: flex;
    align-items: center;
    // 使用新的中性文字颜色变量
    color: var(--lk-text-secondary);
    flex-shrink: 0;
    margin-left: var(--lk-spacing-sm);
  }

  @include e(clear) {
    margin-left: var(--lk-spacing-xs);
    font-size: 32rpx;
    padding: var(--lk-spacing-xxs);
    // 使用新的中性文字颜色变量
    color: var(--lk-text-secondary);
    border-radius: var(--lk-radius-sm);
    transition:
      background var(--lk-transition-fast),
      color var(--lk-transition-fast);

    &:active {
      background: var(--lk-color-bg-active);
    }
  }

  @include e(count) {
    margin-left: var(--lk-spacing-xs);
    font-size: 22rpx;
    // 使用新的中性文字颜色变量
    color: var(--lk-text-secondary);
  }

  // 假输入框样式
  @include e(fake) {
    flex: 1;
    height: var(--_height);
    display: flex;
    align-items: center;
  }

  @include e(fake-text) {
    color: var(--lk-text-placeholder);
    font-size: var(--_fs);
  }

  // 假输入框状态
  @include when(fake) {
    cursor: pointer;

    &:active {
      background: var(--lk-bg-active);
    }
  }

  &:hover:not(.is-disabled):not(.is-readonly):not(.is-fake) {
    border-color: var(--_border-hover);
  }

  &:active:not(.is-disabled):not(.is-readonly):not(.is-fake) {
    border-color: var(--_border-active);
  }

  &:focus-within:not(.is-disabled):not(.is-readonly):not(.is-fake) {
    border-color: var(--_border-active);
    box-shadow: var(--lk-input-shadow-focus);
  }

  @include when(disabled) {
    opacity: 0.6;
    cursor: not-allowed;
  }

  @include when(readonly) {
    background: var(--lk-color-bg-disabled);
  }

  // 密码明暗切换按钮
  @include e(password-toggle) {
    display: flex;
    align-items: center;
    margin-left: var(--lk-spacing-xs);
    color: var(--lk-text-secondary);
    cursor: pointer;
    flex-shrink: 0;
    padding: var(--lk-spacing-xxs);
    border-radius: var(--lk-radius-sm);
    transition: color var(--lk-transition-fast);

    &:active {
      color: var(--lk-color-primary);
    }
  }

  // 输入内容对齐方式
  @include e(inner) {
    &--center {
      text-align: center;
    }
    &--right {
      text-align: right;
    }
  }

  /* 表单错误态（父 .lk-form-item.is-error 加的类） */
  :global(.lk-form-item.is-error) & {
    border-color: var(--lk-color-danger);
    box-shadow: 0 0 0 4rpx var(--lk-color-danger-soft);
  }
}
