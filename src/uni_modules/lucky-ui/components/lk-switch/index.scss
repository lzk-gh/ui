@use '../../theme/src/mixins/bem' as *;

@include b(switch) {
  // 基础变量
  --switch-height: 52rpx;
  --switch-gap: 4rpx;
  --switch-duration: 0.25s;

  // 颜色（可通过 style 覆盖）
  --switch-active-color: var(--lk-color-primary, #409eff);
  --switch-inactive-color: var(--lk-color-border, #dcdfe6);
  // 滑块颜色默认白色，支持自定义
  --switch-knob-color: #ffffff;

  // 计算属性
  --switch-width: calc(var(--switch-height) * 1.8);
  --switch-knob-size: calc(var(--switch-height) - var(--switch-gap) * 2);
  --switch-translate: calc(var(--switch-width) - var(--switch-knob-size) - var(--switch-gap) * 2);

  position: relative;
  display: inline-flex;
  align-items: center;
  width: var(--switch-width);
  height: var(--switch-height);
  padding: var(--switch-gap);
  border-radius: var(--switch-height);
  background: var(--switch-inactive-color);
  box-sizing: border-box;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
  transition: background var(--switch-duration) ease;

  // 尺寸
  @include m(sm) {
    --switch-height: 40rpx;
  }
  @include m(lg) {
    --switch-height: 64rpx;
  }

  // 滑块
  @include e(knob) {
    display: flex;
    align-items: center;
    justify-content: center;
    width: var(--switch-knob-size);
    height: var(--switch-knob-size);
    background: var(--switch-knob-color);
    border-radius: 50%;
    box-shadow: 0 2rpx 6rpx rgba(0, 0, 0, 0.15);
    transition:
      transform var(--switch-duration) ease,
      width var(--switch-duration) ease;
  }

  // 加载动画
  @include e(spinner) {
    width: 50%;
    height: 50%;
    border: 3rpx solid rgba(0, 0, 0, 0.1);
    border-top-color: var(--switch-active-color);
    border-radius: 50%;
    animation: lk-switch-spin 0.8s linear infinite;
  }

  // 选中状态
  @include when(checked) {
    background: var(--switch-active-color);

    .lk-switch__knob {
      transform: translateX(var(--switch-translate));
    }

    .lk-switch__spinner {
      border-top-color: var(--switch-inactive-color);
    }
  }

  // 禁用状态
  @include when(disabled) {
    opacity: 0.5;
    cursor: not-allowed;
  }

  // 加载状态
  @include when(loading) {
    cursor: wait;
    opacity: 0.8;
  }

  // 内嵌文字提示（ON / OFF）
  @include e(prompt) {
    font-size: calc(var(--switch-knob-size) * 0.4);
    line-height: 1;
    color: var(--switch-active-color);
    font-weight: 600;
    white-space: nowrap;
    user-select: none;
  }

  &.is-checked .lk-switch__prompt {
    color: var(--switch-inactive-color);
  }

  // 按压反馈（非禁用/非加载时）
  &:active:not(.is-disabled):not(.is-loading) {
    .lk-switch__knob {
      width: calc(var(--switch-knob-size) + 8rpx);
    }

    &.is-checked .lk-switch__knob {
      transform: translateX(calc(var(--switch-translate) - 8rpx));
    }
  }
}

@keyframes lk-switch-spin {
  to {
    transform: rotate(360deg);
  }
}
