@use '../../theme/src/mixins/bem' as *;

@include b(table) {
  --_bg-head: var(--lk-color-bg-container);
  --_bg-body: var(--lk-color-bg-container);
  --_bg-hover: var(--lk-color-bg-hover);
  --_bg-stripe: var(--lk-color-fill-quaternary);
  --_border: var(--lk-color-border-light);
  --_text: var(--lk-color-text);
  --_radius: var(--lk-radius-lg);

  position: relative;
  width: 100%;
  font-size: var(--lk-font-size-sm);
  color: var(--_text);
  border-radius: var(--_radius);
  overflow: hidden;

  @include when(bordered) {
    border: 2rpx solid var(--_border);
  }

  @include e(wrapper) {
    width: 100%;
    position: relative;
  }

  @include e(scroll) {
    width: 100%;
    overflow: auto;
    -webkit-overflow-scrolling: touch;
  }

  @include e(header) {
    background: var(--_bg-head);

    @include when(sticky) {
      position: sticky;
      top: 0;
      z-index: 10;
      box-shadow: 0 4rpx 10rpx rgba(0, 0, 0, 0.04);
    }
  }

  @include e(tr) {
    display: flex;
    align-items: stretch;
    min-height: 88rpx;

    @include m(head) {
      font-weight: 600;
      font-size: var(--lk-font-size-sm);

      @include e(th) {
        font-weight: 600;
      }
    }

    @include m(summary) {
      font-weight: 600;
      background: var(--lk-color-primary-soft);

      .summary-cell {
        font-size: var(--lk-font-size-xs);
        color: var(--lk-color-primary-active);
      }
    }

    @include when(selected) {
      background: var(--lk-color-primary-soft);

      @include e((td, th)) {
        font-weight: 500;
        color: var(--lk-color-primary-active);
      }
    }

    &:not(.lk-table__tr--summary):not(.lk-table__tr--head):active {
      background: var(--_bg-hover);
    }
  }

  @include e((th, td)) {
    flex-shrink: 0;
    padding: 0 var(--lk-spacing-sm);
    display: flex;
    align-items: center;
    position: relative;
    line-height: 1.3;
    background: transparent;
    font-size: var(--lk-font-size-sm);
    min-width: 120rpx;
    box-sizing: border-box;

    @include m(checkbox) {
      width: 88rpx;
      min-width: 88rpx;
      justify-content: center;
    }

    @include m(index) {
      width: 72rpx;
      min-width: 72rpx;
      justify-content: center;
      font-variant-numeric: tabular-nums;
    }
  }

  @include e(th) {
    height: 90rpx;
    background: var(--_bg-head);
    border-bottom: 2rpx solid var(--_border);
    font-weight: 500;

    @include when(sortable) {
      cursor: pointer;
      user-select: none;
      padding-right: 56rpx;
    }
  }

  @include e(sort-icons) {
    position: absolute;
    right: 20rpx;
    top: 50%;
    transform: translateY(-50%);
    width: 20rpx;
    display: flex;
    flex-direction: column;
    gap: 6rpx;

    .asc,
    .desc {
      width: 0;
      height: 0;
      border-left: 10rpx solid transparent;
      border-right: 10rpx solid transparent;
      opacity: 0.35;
    }

    .asc {
      border-bottom: 14rpx solid var(--lk-color-text);
    }

    .desc {
      border-top: 14rpx solid var(--lk-color-text);
    }
  }

  .is-sorted-asc .lk-table__sort-icons .asc,
  .is-sorted-desc .lk-table__sort-icons .desc {
    opacity: 1;
    filter: drop-shadow(0 0 4rpx var(--lk-color-primary-soft));
  }

  @include e(body) {
    background: var(--_bg-body);

    .lk-table__tr:nth-child(2n) {
      @include when(striped, false) {
        background: var(--_bg-stripe);
      }
    }
  }

  @include e(td) {
    border-bottom: 2rpx solid var(--_border);
    font-size: var(--lk-font-size-sm);

    &.summary-cell {
      border-top: 2rpx solid var(--_border);
      border-bottom: none;
    }
  }

  @include when(striped) {
    @include e(body) {
      .lk-table__tr:nth-child(2n) {
        background: var(--_bg-stripe);
      }
    }
  }

  @include when(compact) {
    @include e((th, td)) {
      padding: 0 var(--lk-spacing-xs);
      min-height: 72rpx;
    }

    @include e(tr) {
      min-height: 72rpx;
    }
  }

  @include e(empty) {
    padding: 60rpx var(--lk-spacing-xs);
    text-align: center;
    font-size: var(--lk-font-size-sm);
    color: var(--lk-color-text-secondary);
  }

  @include e(loading) {
    position: absolute;
    left: 0;
    top: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.65);
    backdrop-filter: blur(4px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 20;
  }

  @include e(footer) {
    @include e(tr) {
      @include m(summary) {
        border-top: 2rpx solid var(--_border);
      }
    }
  }
}

/* 暗色适配 */
:global([data-theme='dark']) {
  @include b(table) {
    --_bg-head: var(--lk-color-bg-container);
    --_bg-body: var(--lk-color-bg-container);
    --_bg-hover: rgba(255, 255, 255, 0.06);
    --_bg-stripe: rgba(255, 255, 255, 0.04);
    --_border: var(--lk-color-border-light);

    @include e(loading) {
      background: rgba(0, 0, 0, 0.45);
    }
  }
}
