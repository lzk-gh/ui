@use '../../theme/src/mixins/bem' as *;

@include b(table) {
  --_bg-head: var(--lk-fill-1);
  --_bg-body: var(--lk-bg-container);
  --_bg-hover: var(--lk-bg-active);
  --_bg-stripe: var(--lk-fill-1);
  --_border: var(--lk-color-border-light);
  --_text: var(--lk-text-primary);
  --_radius: var(--lk-radius-lg);

  position: relative;
  width: 100%;
  font-size: var(--lk-font-size-sm);
  color: var(--_text);
  border-radius: var(--_radius);
  overflow: hidden;

  @include when(bordered) {
    border: 2rpx solid var(--_border);
  }

  @include e(wrapper) {
    width: 100%;
    position: relative;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  @include e(scroll) {
    width: 100%;
    min-width: 100%;
  }

  @include e(header) {
    background: var(--_bg-head);

    @include when(sticky) {
      position: sticky;
      top: 0;
      z-index: 10;
      box-shadow: 0 4rpx 10rpx rgba(0, 0, 0, 0.04);
    }
  }

  @include e(tr) {
    display: flex;
    align-items: stretch;
    min-height: 88rpx;

    @include m(head) {
      font-weight: 600;
      font-size: var(--lk-font-size-sm);
    }

    @include m(summary) {
      font-weight: 600;
      background: var(--lk-color-primary-soft);

      .lk-table__td {
        font-size: var(--lk-font-size-xs);
        color: var(--lk-color-primary);
      }
    }

    @include when(selected) {
      background: var(--lk-color-primary-soft);
    }

    &:not(.lk-table__tr--summary):not(.lk-table__tr--head):active {
      background: var(--_bg-hover);
    }
  }

  @include e((th, td)) {
    flex: 1;
    min-width: 120rpx;
    padding: 0 var(--lk-spacing-md);
    display: flex;
    align-items: center;
    position: relative;
    line-height: 1.4;
    background: transparent;
    font-size: var(--lk-font-size-sm);
    box-sizing: border-box;

    @include m(checkbox) {
      width: 88rpx;
      min-width: 88rpx;
      flex: none;
      justify-content: center;
    }

    @include m(index) {
      width: 72rpx;
      min-width: 72rpx;
      flex: none;
      justify-content: center;
      font-variant-numeric: tabular-nums;
    }

    @include m(action) {
      flex: none;
      justify-content: center;
      position: sticky;
      right: 0;
      background: inherit;
      box-shadow: -4rpx 0 8rpx rgba(0, 0, 0, 0.05);
      z-index: 5;
    }
  }

  @include e(th) {
    height: 96rpx;
    background: var(--_bg-head);
    border-bottom: 2rpx solid var(--_border);
    font-weight: 500;
    color: var(--lk-text-secondary);

    @include when(sortable) {
      cursor: pointer;
      user-select: none;
      padding-right: 56rpx;
    }
  }

  @include e(sort-icons) {
    position: absolute;
    right: 20rpx;
    top: 50%;
    transform: translateY(-50%);
    width: 20rpx;
    display: flex;
    flex-direction: column;
    gap: 6rpx;
  }

  @include e(sort-asc) {
    width: 0;
    height: 0;
    border-left: 10rpx solid transparent;
    border-right: 10rpx solid transparent;
    opacity: 0.35;
    border-bottom: 14rpx solid var(--lk-text-secondary);
  }

  @include e(sort-desc) {
    width: 0;
    height: 0;
    border-left: 10rpx solid transparent;
    border-right: 10rpx solid transparent;
    opacity: 0.35;
    border-top: 14rpx solid var(--lk-text-secondary);
  }

  .is-sorted-asc .lk-table__sort-asc,
  .is-sorted-desc .lk-table__sort-desc {
    opacity: 1;
    border-bottom-color: var(--lk-color-primary);
    border-top-color: var(--lk-color-primary);
  }

  @include e(body) {
    background: var(--_bg-body);
  }

  @include when(striped) {
    @include e(body) {
      .lk-table__tr:nth-child(2n) {
        background: var(--_bg-stripe);

        .lk-table__td--action {
          background: var(--_bg-stripe);
        }
      }
    }
  }

  @include e(td) {
    border-bottom: 2rpx solid var(--_border);
    font-size: var(--lk-font-size-sm);
    background: var(--_bg-body);
  }

  @include when(compact) {
    @include e((th, td)) {
      padding: 0 var(--lk-spacing-sm);
    }

    @include e(tr) {
      min-height: 72rpx;
    }

    @include e(th) {
      height: 80rpx;
    }
  }

  @include e(action-btn) {
    padding: 12rpx 20rpx;
    font-size: var(--lk-font-size-xs);
    font-weight: 500;
    color: var(--lk-color-primary);
    background: transparent;
    border: none;
    border-radius: var(--lk-radius-sm);
    transition: all 0.2s ease;
    white-space: nowrap;

    &:active {
      opacity: 0.7;
      background: var(--lk-bg-active);
    }

    @include m(danger) {
      color: var(--lk-color-danger);
    }

    @include m(warning) {
      color: var(--lk-color-warning);
    }
  }

  @include e(checkbox) {
    width: 40rpx;
    height: 40rpx;
    border: 3rpx solid var(--lk-color-border);
    border-radius: var(--lk-radius-sm);
    position: relative;
    transition: all 0.2s ease;

    @include when(checked) {
      background: var(--lk-color-primary);
      border-color: var(--lk-color-primary);

      &::after {
        content: '';
        position: absolute;
        left: 50%;
        top: 45%;
        width: 12rpx;
        height: 20rpx;
        border: 3rpx solid #fff;
        border-top: none;
        border-left: none;
        transform: translate(-50%, -50%) rotate(45deg);
      }
    }

    @include when(indeterminate) {
      background: var(--lk-color-primary);
      border-color: var(--lk-color-primary);

      &::after {
        content: '';
        position: absolute;
        left: 50%;
        top: 50%;
        width: 20rpx;
        height: 4rpx;
        background: #fff;
        transform: translate(-50%, -50%);
      }
    }
  }

  @include e(empty) {
    padding: 80rpx 32rpx;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 16rpx;
  }

  @include e(empty-icon) {
    font-size: 80rpx;
    opacity: 0.5;
  }

  @include e(empty-text) {
    font-size: var(--lk-font-size-sm);
    color: var(--lk-text-secondary);
  }

  @include e(loading) {
    padding: 60rpx;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 16rpx;
  }

  @include e(loading-spinner) {
    width: 48rpx;
    height: 48rpx;
    border: 4rpx solid var(--lk-color-border);
    border-top-color: var(--lk-color-primary);
    border-radius: 50%;
    animation: lk-table-spin 0.8s linear infinite;
  }

  @include e(loading-text) {
    font-size: var(--lk-font-size-xs);
    color: var(--lk-text-secondary);
  }

  @include e(footer) {
    border-top: 2rpx solid var(--_border);
  }
}

@keyframes lk-table-spin {
  to {
    transform: rotate(360deg);
  }
}
