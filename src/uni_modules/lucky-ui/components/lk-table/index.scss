@use '../../theme/src/mixins/bem' as *;

@include b(table) {
  --_bg-head: var(--lk-color-bg-container);
  --_bg-body: var(--lk-color-bg-container);
  --_bg-hover: var(--lk-color-bg-hover);
  --_bg-stripe: var(--lk-color-fill-quaternary);
  --_border: var(--lk-color-border-light);
  --_text: var(--lk-color-text);
  --_radius: var(--lk-radius-lg);

  position: relative;
  width: 100%;
  font-size: var(--lk-font-size-sm);
  color: var(--_text);

  // ======================== 卡片模式 ========================
  @include m(card) {
    @include e(toolbar) {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 24rpx 32rpx;
      background: var(--_bg-body);
      border-bottom: 2rpx solid var(--_border);
    }

    @include e(toolbar-left) {
      display: flex;
      align-items: center;
      gap: 16rpx;
    }

    @include e(toolbar-text) {
      font-size: var(--lk-font-size-sm);
      color: var(--lk-color-text-secondary);
    }

    @include e(toolbar-count) {
      color: var(--lk-color-primary);
      font-weight: 500;
    }

    @include e(cards) {
      display: flex;
      flex-direction: column;
      gap: 24rpx;
      padding: 24rpx;
      overflow-y: auto;
    }

    @include e(card) {
      display: flex;
      align-items: flex-start;
      background: var(--_bg-body);
      border-radius: var(--_radius);
      box-shadow: 0 4rpx 16rpx rgba(0, 0, 0, 0.06);
      overflow: hidden;
      position: relative;
      transition: all 0.2s ease;

      &:active {
        transform: scale(0.98);
        box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.08);
      }

      @include when(selected) {
        border: 2rpx solid var(--lk-color-primary);
        background: var(--lk-color-primary-soft);
      }
    }

    @include e(card-checkbox) {
      padding: 24rpx 16rpx 24rpx 24rpx;
      flex-shrink: 0;
    }

    @include e(card-body) {
      flex: 1;
      padding: 24rpx 24rpx 24rpx 0;
      min-width: 0;
    }

    @include e(card-main) {
      margin-bottom: 16rpx;
    }

    @include e(card-primary) {
      font-size: var(--lk-font-size-md);
      font-weight: 600;
      color: var(--lk-color-text);
      line-height: 1.4;
    }

    @include e(card-secondary) {
      display: flex;
      flex-wrap: wrap;
      gap: 16rpx 32rpx;
    }

    @include e(card-field) {
      display: flex;
      align-items: center;
      gap: 8rpx;
    }

    @include e(card-label) {
      font-size: var(--lk-font-size-xs);
      color: var(--lk-color-text-tertiary);
    }

    @include e(card-value) {
      font-size: var(--lk-font-size-sm);
      color: var(--lk-color-text-secondary);
    }

    @include e(card-expand) {
      margin-top: 20rpx;
      padding-top: 20rpx;
      border-top: 2rpx solid var(--_border);
    }

    @include e(card-toggle) {
      padding: 24rpx 24rpx 24rpx 0;
      flex-shrink: 0;
    }

    @include e(expand-icon) {
      width: 32rpx;
      height: 32rpx;
      position: relative;

      &::before,
      &::after {
        content: '';
        position: absolute;
        background: var(--lk-color-text-tertiary);
        transition: transform 0.2s ease;
      }

      &::before {
        width: 16rpx;
        height: 4rpx;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

      &::after {
        width: 4rpx;
        height: 16rpx;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

      @include when(expanded) {
        &::after {
          transform: translate(-50%, -50%) rotate(90deg);
        }
      }
    }

    @include e(card-actions) {
      display: flex;
      flex-direction: column;
      align-self: stretch;
    }

    @include e(action) {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 32rpx;
      font-size: var(--lk-font-size-sm);
      font-weight: 500;
      color: #fff;
      min-width: 120rpx;

      @include m(default) {
        background: var(--lk-color-text-tertiary);
      }

      @include m(primary) {
        background: var(--lk-color-primary);
      }

      @include m(danger) {
        background: #ff4d4f;
      }

      @include m(warning) {
        background: #faad14;
      }
    }

    @include e(summary) {
      margin: 0 24rpx 24rpx;
      padding: 24rpx;
      background: var(--lk-color-primary-soft);
      border-radius: var(--_radius);
    }

    @include e(summary-title) {
      font-size: var(--lk-font-size-sm);
      font-weight: 600;
      color: var(--lk-color-primary);
      margin-bottom: 16rpx;
    }

    @include e(summary-content) {
      display: flex;
      flex-wrap: wrap;
      gap: 24rpx;
    }

    @include e(summary-item) {
      display: flex;
      flex-direction: column;
      gap: 4rpx;
    }

    @include e(summary-label) {
      font-size: var(--lk-font-size-xs);
      color: var(--lk-color-text-tertiary);
    }

    @include e(summary-value) {
      font-size: var(--lk-font-size-md);
      font-weight: 600;
      color: var(--lk-color-primary);
    }
  }

  // ======================== 表格模式 ========================
  @include m(table) {
    border-radius: var(--_radius);
    overflow: hidden;

    @include when(bordered) {
      border: 2rpx solid var(--_border);
    }
  }

  @include e(wrapper) {
    width: 100%;
    position: relative;
  }

  @include e(scroll) {
    width: 100%;
    -webkit-overflow-scrolling: touch;
  }

  @include e(header) {
    background: var(--_bg-head);

    @include when(sticky) {
      position: sticky;
      top: 0;
      z-index: 10;
      box-shadow: 0 4rpx 10rpx rgba(0, 0, 0, 0.04);
    }
  }

  @include e(tr) {
    display: flex;
    align-items: stretch;
    min-height: 88rpx;

    @include m(head) {
      font-weight: 600;
      font-size: var(--lk-font-size-sm);
    }

    @include m(summary) {
      font-weight: 600;
      background: var(--lk-color-primary-soft);

      .lk-table__td {
        font-size: var(--lk-font-size-xs);
        color: var(--lk-color-primary-active);
      }
    }

    @include when(selected) {
      background: var(--lk-color-primary-soft);
    }

    &:not(.lk-table__tr--summary):not(.lk-table__tr--head):active {
      background: var(--_bg-hover);
    }
  }

  @include e((th, td)) {
    flex-shrink: 0;
    padding: 0 var(--lk-spacing-sm);
    display: flex;
    align-items: center;
    position: relative;
    line-height: 1.3;
    background: transparent;
    font-size: var(--lk-font-size-sm);
    min-width: 120rpx;
    box-sizing: border-box;

    @include m(checkbox) {
      width: 88rpx;
      min-width: 88rpx;
      justify-content: center;
    }

    @include m(index) {
      width: 72rpx;
      min-width: 72rpx;
      justify-content: center;
      font-variant-numeric: tabular-nums;
    }
  }

  @include e(th) {
    height: 90rpx;
    background: var(--_bg-head);
    border-bottom: 2rpx solid var(--_border);
    font-weight: 500;

    @include when(sortable) {
      cursor: pointer;
      user-select: none;
      padding-right: 56rpx;
    }
  }

  @include e(sort-icons) {
    position: absolute;
    right: 20rpx;
    top: 50%;
    transform: translateY(-50%);
    width: 20rpx;
    display: flex;
    flex-direction: column;
    gap: 6rpx;
  }

  @include e(sort-asc) {
    width: 0;
    height: 0;
    border-left: 10rpx solid transparent;
    border-right: 10rpx solid transparent;
    opacity: 0.35;
    border-bottom: 14rpx solid var(--lk-color-text);
  }

  @include e(sort-desc) {
    width: 0;
    height: 0;
    border-left: 10rpx solid transparent;
    border-right: 10rpx solid transparent;
    opacity: 0.35;
    border-top: 14rpx solid var(--lk-color-text);
  }

  .is-sorted-asc .lk-table__sort-asc,
  .is-sorted-desc .lk-table__sort-desc {
    opacity: 1;
  }

  @include e(body) {
    background: var(--_bg-body);
  }

  @include when(striped) {
    @include e(body) {
      .lk-table__tr:nth-child(2n) {
        background: var(--_bg-stripe);
      }
    }
  }

  @include e(td) {
    border-bottom: 2rpx solid var(--_border);
    font-size: var(--lk-font-size-sm);
  }

  @include when(compact) {
    @include e((th, td)) {
      padding: 0 var(--lk-spacing-xs);
    }

    @include e(tr) {
      min-height: 72rpx;
    }
  }

  // ======================== 复选框 ========================
  @include e(checkbox) {
    width: 40rpx;
    height: 40rpx;
    border: 3rpx solid var(--lk-color-border);
    border-radius: var(--lk-radius-sm);
    position: relative;
    transition: all 0.2s ease;

    @include when(checked) {
      background: var(--lk-color-primary);
      border-color: var(--lk-color-primary);

      &::after {
        content: '';
        position: absolute;
        left: 50%;
        top: 45%;
        width: 12rpx;
        height: 20rpx;
        border: 3rpx solid #fff;
        border-top: none;
        border-left: none;
        transform: translate(-50%, -50%) rotate(45deg);
      }
    }

    @include when(indeterminate) {
      background: var(--lk-color-primary);
      border-color: var(--lk-color-primary);

      &::after {
        content: '';
        position: absolute;
        left: 50%;
        top: 50%;
        width: 20rpx;
        height: 4rpx;
        background: #fff;
        transform: translate(-50%, -50%);
      }
    }
  }

  // ======================== 空状态/加载 ========================
  @include e(empty) {
    padding: 80rpx 32rpx;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 16rpx;
  }

  @include e(empty-icon) {
    font-size: 80rpx;
    opacity: 0.5;
  }

  @include e(empty-text) {
    font-size: var(--lk-font-size-sm);
    color: var(--lk-color-text-secondary);
  }

  @include e(loading) {
    padding: 60rpx;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 16rpx;
  }

  @include e(loading-spinner) {
    width: 48rpx;
    height: 48rpx;
    border: 4rpx solid var(--lk-color-border);
    border-top-color: var(--lk-color-primary);
    border-radius: 50%;
    animation: lk-table-spin 0.8s linear infinite;
  }

  @include e(loading-text) {
    font-size: var(--lk-font-size-xs);
    color: var(--lk-color-text-secondary);
  }

  @include e(footer) {
    border-top: 2rpx solid var(--_border);
  }
}

@keyframes lk-table-spin {
  to {
    transform: rotate(360deg);
  }
}

/* 暗色适配 */
:global([data-theme='dark']) {
  @include b(table) {
    --_bg-head: var(--lk-color-bg-container);
    --_bg-body: var(--lk-color-bg-container);
    --_bg-hover: rgba(255, 255, 255, 0.06);
    --_bg-stripe: rgba(255, 255, 255, 0.04);
    --_border: var(--lk-color-border-light);
  }
}
