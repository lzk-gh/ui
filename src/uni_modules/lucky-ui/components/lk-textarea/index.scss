@use '../../theme/src/mixins' as *;

@include b(textarea) {
  // --- CSS Token 映射 (连接你的主题系统) ---
  // 1. 颜色
  --lk-ta-color-primary: var(--lk-color-primary, #2979ff);
  --lk-ta-color-error: var(--lk-color-danger, #ef4444);
  // 使用新的中性文字颜色变量
  --lk-ta-text-color: var(--lk-text-primary);
  --lk-ta-text-color-secondary: var(--lk-text-placeholder);
  --lk-ta-text-color-disabled: var(--lk-color-text-disabled, #c0c4cc);

  // 2. 背景 (关键改进：支持透明和填充)
  --lk-ta-bg: var(--lk-bg-container);
  // 填充模式使用统一的控件填充色（更干净的颜色）
  --lk-ta-bg-filled: var(--lk-bg-input);
  --lk-ta-bg-disabled: var(--lk-fill-1);

  // 3. 边框
  --lk-ta-border-color: var(--lk-border-color, var(--lk-color-border, #dcdfe6));
  --lk-ta-border-radius: var(--lk-radius-md, 12rpx);

  // 4. 尺寸
  --lk-ta-fs: var(--lk-control-font-size-md, 28rpx);
  --lk-ta-padding: 24rpx;

  position: relative;
  display: flex;
  flex-direction: column;
  width: 100%;
  box-sizing: border-box;
  font-size: var(--lk-ta-fs);
  color: var(--lk-ta-text-color);
  transition: all 0.2s;

  // --- 变体 Variant 实现 ---

  // 1. Outline (默认描边)
  @include m(outline) {
    background-color: var(--lk-ta-bg);
    border: 2rpx solid var(--lk-ta-border-color);
    border-radius: var(--lk-ta-border-radius);

    @include when(focused) {
      border-color: var(--lk-ta-color-primary);
      // 可选：添加光晕
      box-shadow: 0 0 0 4rpx rgb(var(--color-brand-rgb, 41, 121, 255) / 15%);
    }
  }

  // 2. Filled (填充风格 - 现代感强，无边框)
  @include m(filled) {
    background-color: var(--lk-ta-bg-filled);
    border: 2rpx solid transparent; // 预留边框位防抖动
    border-radius: var(--lk-ta-border-radius);

    @include when(focused) {
      background-color: var(--lk-ta-bg); // 聚焦变白
      border-color: var(--lk-ta-color-primary);
    }
  }

  // 3. Flush (无边框 - 极简)
  @include m(flush) {
    background-color: transparent;
    border: none;
    border-bottom: 2rpx solid var(--lk-ta-border-color);
    border-radius: 0;
    padding-left: 0;
    padding-right: 0;

    @include when(focused) {
      border-bottom-color: var(--lk-ta-color-primary);
    }
  }

  // --- 状态 ---

  @include when(disabled) {
    opacity: 0.7;
    cursor: not-allowed;
    background-color: var(--lk-ta-bg-disabled);
    color: var(--lk-ta-text-color-disabled);
  }

  // --- 内部元素 ---

  @include e(label) {
    margin-bottom: 12rpx;
    font-size: 26rpx;
    font-weight: 500;
    color: var(--lk-ta-text-color);
    padding: 0 8rpx; // 对齐视觉
  }

  @include e(wrapper) {
    display: flex;
    flex-direction: row;
    align-items: flex-start;
    padding: var(--lk-ta-padding);
    width: 100%;
    box-sizing: border-box;
  }

  @include e(inner) {
    flex: 1;
    width: 100%;
    background: transparent;
    font-size: inherit;
    line-height: 1.5;
    color: inherit;
    min-height: 48rpx;
    padding: 0;
  }

  @include e(placeholder) {
    // 使用新的占位符颜色变量
    color: var(--lk-text-placeholder);
  }

  // --- 右侧区域 (清空按钮) ---
  @include e(suffix) {
    display: flex;
    align-items: flex-start; // 靠上对齐
    margin-left: 16rpx;
  }

  @include e(clear) {
    width: 40rpx;
    height: 40rpx;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background-color: rgba(0, 0, 0, 0.05); // 浅灰底
    transition: background-color 0.2s;
    cursor: pointer;

    &:active {
      background-color: rgba(0, 0, 0, 0.15); // 点击深色反馈
    }

    // 纯CSS绘制关闭图标 (建议替换为 <lk-icon>)
    .lk-icon-close {
      position: relative;
      width: 16rpx;
      height: 16rpx;
      &::before,
      &::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 100%;
        height: 2rpx;
        background-color: #999;
        transform: translate(-50%, -50%) rotate(45deg);
      }
      &::after {
        transform: translate(-50%, -50%) rotate(-45deg);
      }
    }
  }

  // --- 底部 Footer ---
  @include e(footer) {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 var(--lk-ta-padding) 16rpx;
    margin-top: -8rpx; // 拉近一点距离
  }

  @include e(count) {
    font-size: 22rpx;
    // 使用新的中性文字颜色变量
    color: var(--lk-text-secondary);
    margin-left: auto; // 挤到最右边
  }
}
