// ─────────────────────────────────────────────────────────────────────────────
// lk-timeline  ·  Apple Design Language  v2
// ─────────────────────────────────────────────────────────────────────────────
// 修复点：
//   1. 连接线高度与右侧内容严格对齐（align-items: stretch + flex:1 line）
//   2. 统一品牌色 —— 全部使用 primary，pending 降透明，error 用描边方式
//   3. 左侧列插槽（时间/自定义） + 右侧内容列（三列布局）
//   4. 节点圆统一 32rpx，所有变体等宽不撑开
// ─────────────────────────────────────────────────────────────────────────────

// ── Variables ─────────────────────────────────────────────────────────────────

$dot-size: 32rpx;
$track-width: 48rpx; // 轨道列宽（含节点两侧空白）
$left-col-width: 96rpx; // 左侧时间列固定宽
$item-gap: 48rpx; // 项目间距（padding-bottom 实现，线穿过 gap）
$line-width: 2rpx;
$line-offset-top: 38rpx; // dot(32) + 间距(6)

// ── 容器 ──────────────────────────────────────────────────────────────────────

.lk-timeline {
  display: flex;

  &--vertical {
    flex-direction: column;
  }

  &--horizontal {
    flex-direction: row;
    overflow-x: auto;
    padding-bottom: 16rpx;

    // #ifdef H5
    &::-webkit-scrollbar {
      display: none;
    }
    // #endif
  }
}

// ── 条目 ──────────────────────────────────────────────────────────────────────

.lk-timeline-item {
  --lk-ti-accent: var(--lk-color-primary, #007aff);

  display: flex;
  position: relative;

  // ── 垂直布局 ────────────────────────────────────────────────────────────────
  &--vertical {
    flex-direction: row;
    align-items: stretch;
    padding-bottom: $item-gap;

    // 修复：竖线需要跨越父级 padding 区域才能触达下一个节点
    .lk-timeline-item__line {
      bottom: calc(-#{$item-gap} + 4rpx); 
    }

    &:last-child {
      padding-bottom: 0;

      .lk-timeline-item__line {
        display: none;
      }
    }
  }

  // ── 水平布局 ────────────────────────────────────────────────────────────────
  &--horizontal {
    flex-direction: column;
    align-items: flex-start;
    min-width: 260rpx;
    padding-right: $item-gap;

    &:last-child {
      padding-right: 0;

      .lk-timeline-item__line {
        display: none;
      }
    }

    .lk-timeline-item__track {
      flex-direction: row;
      align-items: center;
      align-self: auto;
      width: 100%;
      height: 48rpx;
      margin-bottom: 12rpx;
    }

    .lk-timeline-item__line {
      position: static;
      flex: 1;
      width: auto;
      height: $line-width;
      min-height: unset;
      margin-top: 0;
      margin-left: 8rpx;
    }

    .lk-timeline-item__body {
      padding-left: 0;
    }
  }
}

// ── 左侧列（时间 / 自定义左插槽） ────────────────────────────────────────────

.lk-timeline-item__left {
  width: $left-col-width;
  flex-shrink: 0;
  display: flex;
  flex-direction: column;
  align-items: flex-end;  // 右对齐靠近节点
  justify-content: flex-start;
  padding-top: 4rpx;      // 与节点圆中心微对齐
  padding-right: 16rpx;
  gap: 4rpx;
}

// 左侧列 date 标签
.lk-timeline-item__date {
  font-size: 20rpx;
  font-weight: 600;
  color: var(--lk-ti-accent);
  letter-spacing: 0.04em;
  text-transform: uppercase;
  line-height: 1.2;
}

// 左侧列 time 文字
.lk-timeline-item__time {
  font-size: 26rpx;
  font-weight: 500;
  color: var(--lk-color-text, #1c1c1e);
  font-variant-numeric: tabular-nums;
  line-height: 1.2;
}

// ── 轨道（节点 + 线）────────────────────────────────────────────────────────

.lk-timeline-item__track {
  display: flex;
  flex-direction: column;
  align-items: center;
  flex-shrink: 0;
  width: $track-width;
  position: relative;
  align-self: stretch; // 强制拉伸以承载绝对定位的竖线
}

// ── 节点圆 ── FIX4: 所有变体统一 32rpx，不因内容撑开 ──────────────────────────

.lk-timeline-item__dot {
  // 固定尺寸 box — flex-shrink:0 + 明确 width/height
  width: $dot-size;
  height: $dot-size;
  min-width: $dot-size;
  min-height: $dot-size;
  border-radius: 50%;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;       // 防止内部文字溢出撑大
  position: relative;
  transition: transform 200ms cubic-bezier(0.34, 1.56, 0.64, 1),
              opacity 200ms ease;
  z-index: 2;

  // ── filled（默认：实心）──
  &--filled {
    background-color: var(--lk-ti-accent);
  }

  // ── outlined（空心描边）──
  &--outlined {
    background-color: var(--lk-color-bg, #fff);
    border: 4rpx solid var(--lk-ti-accent);
  }

  // ── numbered（数字序号，与 filled 等宽）──
  &--numbered {
    background-color: var(--lk-ti-accent);
    // 不再覆盖 width/height，继承 32rpx
  }

  // ── 激活光晕 ──────────────────────────────
  &.is-active {
    transform: scale(1.2);

    &::after {
      content: '';
      position: absolute;
      inset: -12rpx;
      border-radius: 50%;
      background: var(--lk-ti-accent);
      opacity: 0.15;
      pointer-events: none;
    }
  }
}

// FIX2: pending → 同品牌色，降透明度区分
.is-pending .lk-timeline-item__dot {
  opacity: 0.3;
}

// FIX2: error → 描边 + 实心，仍用 primary
.is-error .lk-timeline-item__dot--filled,
.is-error .lk-timeline-item__dot--numbered {
  background-color: transparent;
  border: 4rpx solid var(--lk-ti-accent);

  .lk-timeline-item__dot-symbol {
    color: var(--lk-ti-accent);
  }
}

// 节点内文字（数字 / ✓ / ✕ / icon）统一样式
.lk-timeline-item__dot-num,
.lk-timeline-item__dot-symbol {
  font-size: 16rpx;
  font-weight: 700;
  color: #fff;
  line-height: 1;
  text-align: center;
  pointer-events: none;
  // 防止 text 节点本身撑大父容器
  display: block;
  width: 100%;
}

// ── 连接线 — FIX1: flex:1 撑满 track 剩余高度 ───────────────────────────────

.lk-timeline-item__line {
  position: absolute;
  top: $line-offset-top;
  bottom: 0;
  left: 23rpx; // ($track-width 48 / 2) - ($line-width 2 / 2)
  width: $line-width;
  background-color: var(--lk-color-border, #e5e5ea);
  border-radius: 999rpx;
  z-index: 1;
  display: block;
  transition: background-color 200ms ease;

  // FIX2: 完成连接线不再变绿
  .is-completed & {
    background-color: var(--lk-color-border, #e5e5ea);
  }
}

// ── 右侧内容区 ────────────────────────────────────────────────────────────────

.lk-timeline-item__body {
  flex: 1;
  min-width: 0;
  padding-left: 16rpx;
  padding-top: 2rpx;  // 与节点圆中心对齐
  display: flex;
  flex-direction: column;
  gap: 6rpx;
}

// ── 标题 ─────────────────────────────────────────────────────────────────────

.lk-timeline-item__title-row {
  display: flex;
  align-items: center;
}

.lk-timeline-item__title {
  font-size: 32rpx;
  font-weight: 600;
  color: var(--lk-color-text, #1c1c1e);
  line-height: 1.3;
  letter-spacing: -0.01em;

  .is-active & {
    color: var(--lk-ti-accent);
  }

  .is-pending & {
    color: var(--lk-color-text-tertiary, #aeaeb2);
  }
}

// ── 副标题（地点 / 备注）─────────────────────────────────────────────────────

.lk-timeline-item__subtitle-row {
  display: flex;
  align-items: center;
}

.lk-timeline-item__subtitle {
  font-size: 24rpx;
  color: var(--lk-color-text-secondary, #8e8e93);
  line-height: 1.4;
}

// ── 正文描述 ──────────────────────────────────────────────────────────────────

.lk-timeline-item__desc-row {
  display: flex;
}

.lk-timeline-item__desc {
  font-size: 28rpx;
  color: var(--lk-color-text-secondary, #636366);
  line-height: 1.6;

  .is-pending & {
    color: var(--lk-color-text-tertiary, #aeaeb2);
  }
}

// ── extra 插槽区（图片预览 / 自定义卡片）────────────────────────────────────

.lk-timeline-item__body > .lk-timeline-item-preview {
  margin-top: 8rpx;
  display: flex;
  gap: 12rpx;
  flex-wrap: wrap;
}

// 图片预览缩略图（demo 中使用，可作为通用类）
.lk-timeline-preview-img {
  width: 120rpx;
  height: 120rpx;
  border-radius: 16rpx;
  overflow: hidden;
  background: var(--lk-color-bg-weak, #f2f2f7);
  flex-shrink: 0;
}

// 图片预览信息块（图 + 文字侧边）
.lk-timeline-preview-card {
  display: flex;
  align-items: flex-start;
  gap: 16rpx;
  margin-top: 8rpx;
  padding: 16rpx;
  background: var(--lk-color-bg-surface, #f2f2f7);
  border-radius: 20rpx;

  &__image {
    width: 100rpx;
    height: 100rpx;
    border-radius: 14rpx;
    flex-shrink: 0;
    background: var(--lk-color-bg-weak, #e5e5ea);
  }

  &__info {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 4rpx;
  }

  &__name {
    font-size: 26rpx;
    font-weight: 600;
    color: var(--lk-color-text, #1c1c1e);
    line-height: 1.3;
  }

  &__meta {
    font-size: 22rpx;
    color: var(--lk-color-text-secondary, #8e8e93);
    line-height: 1.4;
  }
}

